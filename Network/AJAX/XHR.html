<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <ul>
        <h2>waiting for data</h2>
    </ul>

    <script type="module">
        import "../../env.js";
        const BASE_URL = window._ENV.BASE_URL;
        const MOCK_URL = window._ENV.MOCK_URL;
        const url = BASE_URL + "api/citylist"; // "api/movies?page=2&size=10";
        console.log(url);

        var xhr = new XMLHttpRequest(); // 发送请求的对象
        xhr.onreadystatechange = function () {
            // 即使没有这个函数，浏览器也能请求
            // onReadyStateChange 这个函数是用于在 JS 中处理结果
            /*
            当请求状态发生改变的时运行的函数
            xhr.readyState: 一个数字，用于判断请求到了哪个阶段
            0: 刚刚创建好请求对象，但还未配置请求、没有调用open方法
            1: open方法已被调用
            2: send方法已被调用
            3: 正在接收服务器的响应体
            4: 服务器所有相应的内容都接收完毕

            xhr.responseText 服务器响应的消息体文本
            xhr.getResonseHeader("Content-Type") 通过键获取响应头对应值
            */

            console.log(xhr.readyState);

            if (xhr.readyState == 4) {
                // 可以通过节流模式模拟真实请求，感受异步回调
                // 如果是同步的话，那么就阻塞了，得等待现在的 JS 代码
                const obj = JSON.parse(xhr.responseText);
                console.log(obj);

                // 将网络得到的数据 => UI
                const data = obj.data;
                const ul = document.querySelector('ul');
                for (const item of data) {
                    var li = document.createElement('li')
                    li.innerText = item.label;
                    ul.appendChild(li);
                }
            }
        };

        xhr.open('GET', url); // 请求行：请求方法、url地址配置
        // 如果 BASE_URL 没有写 根目录/ 的话 api 前面记得加
        // xhr.setRequestHeader('Content-Type', 'application/json'); // 请求头，例如这里设置了请求体消息格式为json
        xhr.send(null); // 请求体
    </script>
</body>

</html>